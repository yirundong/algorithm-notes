## “表”是什么

借HashMap来表达一下我对“表”这种数据结构的看法,我们经常见到这种结构,但是又不是很明白

实际上表就是一种可查可存的数据结构,可以是Map,Set,List等等,中文语境中我们不区分这些,所以我们说到“表”,实际上是一种泛指,我们想说的是一种可以存入数据然后查的“数据库”,实际上真实的关系型数据库本身就是由无数张表组成的.

## HashMap

HashMap也叫哈希表,是一种给广泛运用于算法与实际生产中的数据结构

在Java中,当我们在内存中申请一个哈希表时,实际上申请到的是一个长度为16的数组,我们往哈希表中存入的是一个个`entry`(音恩吹),中文叫记录.一条记录是由一个`key`和一个`value`也就是键和值组成的,key这个英文通常代表着独一无二,一把钥匙开一把锁嘛,所以我们不能存入有相同键的记录,一旦存入,新的value会覆盖旧的value,这也是哈希表更新记录的方法.但是如果它发现你传入的key是相同的,它不会改变

但是如果它发现你传入是相同的key,它不会用新的key覆盖旧的key,key是不会改变的,提到这主要是因为涉及到有的key是自定义类型,比较的依据只是它的某个属性.这里的相等性是equals方法定义的.

## 散列/序列

hash一词在英文中的语意是“把...弄乱”,这也是有人把其翻译为“散列”表的意思,意为零散排列的数据,也就是“无序”.与之相对的是“序列”,也就是有序的排列.

hash一次可以很好的说明hash表的工作机制,也就是“弄乱”,弄得极致的乱,把数据打乱是很难得,甚至有一个数学领域专门研究打乱---混沌数学!我们如何做到打乱数据呢,借助哈希函数.

假设我们有1000万个数据和一个长度为1000的数组,理想的哈希函数可以做到让每个位置都是一万个数据.总之哈希函数就是用来把我们的数据均匀的铺开到数据结构中的一种手段.

哈希函数有很多,可以自己上网查,这里就说一点,我们可以通过已知两个哈希函数通过以下这个公式构造任意哈希函数

```Java
n * f1 + f2   //f1,f2是哈希函数,n是正整数,这是实践证明过的
```

## Java中哈希表的存入

在Java中,当我们在内存中申请到一个哈希表时,系统会给我们初始长度16的数组,我们会向其中放一条条记录.

它会把我们的key作为输入传进哈希函数,然后计算出一个64位或者128位的hashcode(这要看具体的哈希函数是什么),这个hashcode是均匀的,所以我们把其`mod`哈希数组的长度`length`之后的`index`值也是均匀的.每个数据的index值决定它放在桶数组的哪个“桶”里,所以我们说把数据存入哈希表是均匀放入的.

## 哈希碰撞与扩容

很明显,哈希表的输出是有限的,这样就避免不了一个问题---多个key得到一个hashcode,哪怕你的哈希函数设计的再好也不行.怎么解决呢,有两个方案,它们是共同运行保证哈希表的高效的

一般情况下,当一个桶里有多条记录时,这些记录会变成单链表,但是当数据更多时,Java会有以下机制保证哈希表的高效率

| **机制**         | **触发条件**                                     | **作用范围** | **主要优化点**             |
| ---------------- | ------------------------------------------------ | ------------ | -------------------------- |
| **扩容**         | 元素总数 > 负载因子(默认 0.75) * 桶数组大小      | 整个哈希表   | 减少哈希碰撞，提高全局性能 |
| **链表转红黑树** | 单个桶中的链表长度 > 8（默认值，可通过源码修改） | 单个桶       | 优化单个桶的查找效率       |

红黑树是一颗平衡二叉搜索树,增删改查都是O(logn).选择它主要是它的常数时间好.

扩容会double桶数组的大小,每扩一次链表长度减半,扩容之后所有记录都会重新hash放到桶中,代价比较大.

在此说明,这里的数据都是问的chatgpt,如有不对按你的来.

## 哈希表很快

哈希表是非常快的,增删改查的平均时间复杂度都是O(1).这个复杂度是均摊下来大数据量下的.

这个复杂度不需要证明,记住就行,有兴趣去查.

## 类中的hashcode和equals方法

我们可以自定义这两个方法实现更多功能.

key的类型中定义的hashcode函数就是哈希函数,equals方法定义了该类的两个对象是否相等的规则.当hashcode相等时,我们就是使用equals来分辨不同的key的.这俩一般都是一起重写的,因为一定要保证相等的输入会得到相同的hashcode.

String的hashcode方法叫做31倍哈希.

## HashSet

既然讲到哈希表,顺便讲一下哈希集合,set这种数据结构我们一般叫集合,模拟的是数学中的集合,存入的是不是entry而是key.简单的讲就是不重复的某类值的集合.用的方法也和map大差不差.

## 一些常用的JavaAPI

```Java
HashMap<Integer, String> test = new HashMap<>();
HashSet<String> set = new HashSet<>();
- 增和改:put(key,value)
- 查:containsKey(key)看是否存在,get(key)查对应的值
- 删:remove(key)
```

......

## 总结

哈希函数方面的知识几乎没有代码,就是会使用就行.这就是在Java算法中,你需要知道的哈希表的一切!